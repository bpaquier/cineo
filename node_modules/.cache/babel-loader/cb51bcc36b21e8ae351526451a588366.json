{"ast":null,"code":"var _jsxFileName = \"/Users/bastpaq/Documents/student_projects/semaines-intensives/cineo-bast/cineo/src/context/session.context.jsx\";\nimport React, { createContext, Component } from 'react';\nconst SessionContext = createContext({});\nexport class SessionContextProvider extends Component {\n  constructor(props) {\n    super(props);\n\n    this.signIn = (mail, password, e) => {\n      e.preventDefault();\n      let infosUsers = {};\n      infosUsers.mail = mail;\n      infosUsers.password = password;\n      fetch('https://bastienpaquier.masselab.com/signIn.php', {\n        method: 'POST',\n        body: JSON.stringify(infosUsers)\n      }).then(response => response.json()).then(data => {\n        console.log(data);\n        /* if (data.success) {\n          let userloged = {\n            id: data.user.id,\n            name: data.user.name,\n            lastName: data.user.last_name,\n            pseudo: data.user.pseudo,\n            mail: data.user.mail,\n            signUpDate: data.user.date_inscription,\n          };\n          this.setState({ user: userloged });\n          localStorage.setItem('user', JSON.stringify(userloged));\n           let userId = {};\n          userId.id = data.infos[0].id;\n           fetch('http://18.191.118.60:80/getMoviesList.php', {\n            method: 'POST',\n            body: JSON.stringify(userId),\n          })\n            .then((response) => {\n              return response.json();\n            })\n            .then((data) => {\n              if (data.length > 0) {\n                let movieList = [];\n                data.forEach((movie) => {\n                  movieList.push(movie.id_movie);\n                });\n                this.setState({ movieList: movieList });\n                localStorage.setItem('moviesList', JSON.stringify(movieList));\n              }\n            }); \n        } else {\n          this.setState({ wrongLogin: true });\n        } */\n      });\n    };\n\n    this.signUp = (lastName, firstName, mail, password, pseudo, e) => {\n      e.preventDefault();\n      let data = {};\n      data.lastName = lastName;\n      data.firstName = firstName;\n      data.mail = mail;\n      data.password = password;\n      data.pseudo = pseudo;\n      fetch('https://bastienpaquier.masselab.com/signUp.php', {\n        method: 'POST',\n        body: JSON.stringify(data)\n      }).then(response => response.json()).then(data => {\n        console.log(data);\n\n        if (data.mailExist) {\n          this.setState({\n            mailAlreadyExist: true\n          });\n        } else {\n          let userLoged = {\n            id: data.user.id,\n            name: data.user.name,\n            lastName: data.user.last_name,\n            pseudo: data.user.pseudo,\n            mail: data.user.mail,\n            signUpDate: data.user.date_inscription\n          };\n          this.setState({\n            user: userLoged\n          });\n          localStorage.setItem('user', JSON.stringify(userLoged));\n        }\n      });\n    };\n\n    this.changeWarningStates = () => {\n      this.setState({\n        mailAlreadyExist: false,\n        wrongLogin: false\n      });\n    };\n\n    this.deleteUser = () => {\n      this.setState({\n        user: null,\n        movieList: null\n      });\n      localStorage.removeItem('user');\n      localStorage.removeItem('moviesList');\n      /* let data = {};\n      data.mail = this.state.user.mail;\n       fetch('http://18.191.118.60:80/deleteUser.php', {\n        method: 'POST',\n        body: JSON.stringify(data),\n      })\n        .then((response) => {\n          return response.json();\n        })\n        .then((data) => {\n          this.setState({ user: null });\n          localStorage.removeItem('user');\n          localStorage.removeItem('moviesList');\n        }); */\n    };\n\n    this.logOut = () => {\n      this.setState({\n        user: null,\n        movieList: null\n      });\n      localStorage.removeItem('user');\n      localStorage.removeItem('moviesList');\n    };\n\n    this.addMovie = filmId => {\n      let moviesList;\n\n      if (localStorage.getItem('moviesList')) {\n        moviesList = [...JSON.parse(localStorage.getItem('moviesList'))];\n      } else {\n        moviesList = [];\n      }\n\n      let newList = [...moviesList, filmId];\n      this.setState({\n        movieList: newList\n      });\n      localStorage.setItem('moviesList', JSON.stringify(newList));\n      /* let data = {};\n      data.idUser = this.state.user.id;\n      data.idFilm = filmId.toString();\n       fetch('http://18.191.118.60:80/addFilm.php', {\n        method: 'POST',\n        body: JSON.stringify(data),\n      })\n        .then((response) => {\n          return response.json();\n        })\n        .then((data) => {\n          let movieList = [];\n          data.forEach((movie) => {\n            movieList.push(movie.id_movie);\n          });\n          this.setState({ movieList: movieList });\n          localStorage.setItem('moviesList', JSON.stringify(movieList));\n        }); */\n    };\n\n    this.deleteMovie = id_movie => {\n      const moviesList = [...this.state.movieList];\n      const index = moviesList.findIndex(el => el === id_movie);\n      moviesList.splice(index, 1);\n      this.setState({\n        movieList: moviesList\n      });\n      localStorage.setItem('moviesList', JSON.stringify(moviesList));\n      /* let data = {};\n      data.movieId = id_movie.toString();\n      data.userId = this.state.user.id;\n       fetch('http://18.191.118.60:80/deleteMovie.php', {\n        method: 'POST',\n        body: JSON.stringify(data),\n      })\n        .then((response) => {\n          return response.json();\n        })\n        .then((data) => {\n          console.log(data);\n          let movieList = [];\n          data.forEach((movie) => {\n            movieList.push(movie.id_movie);\n          });\n          this.setState({ movieList: movieList });\n          localStorage.setItem('moviesList', JSON.stringify(movieList));\n        }); */\n    };\n\n    this.changePseudo = pseudo => {\n      const initialUser = JSON.parse(localStorage.getItem('user'));\n      initialUser.pseudo = pseudo;\n      localStorage.setItem('user', JSON.stringify(initialUser));\n      this.setState({\n        user: initialUser\n      });\n      /* let data = {};\n      data.id = this.state.user.id;\n      data.value = pseudo;\n       fetch('http://18.191.118.60:80/changePseudo.php', {\n        method: 'POST',\n        body: JSON.stringify(data),\n      })\n        .then((response) => {\n          return response.json();\n        })\n        .then((data) => {\n          let userLoged = {\n            id: data[0].id,\n            name: data[0].name,\n            lastName: data[0].last_name,\n            pseudo: data[0].pseudo,\n            mail: data[0].mail,\n            signUpDate: data[0].date_inscription,\n          };\n          this.setState({ user: userLoged });\n          localStorage.setItem('user', JSON.stringify(userLoged));\n        }); */\n    };\n\n    this.changeLastName = lastName => {\n      const initialUser = JSON.parse(localStorage.getItem('user'));\n      initialUser.lastName = lastName;\n      localStorage.setItem('user', JSON.stringify(initialUser));\n      this.setState({\n        user: initialUser\n      });\n      /* let data = {};\n      data.id = this.state.user.id;\n      data.value = lastName;\n       fetch('http://18.191.118.60:80/changeLastName.php', {\n        method: 'POST',\n        body: JSON.stringify(data),\n      })\n        .then((response) => {\n          return response.json();\n        })\n        .then((data) => {\n          console.log(data);\n          let userLoged = {\n            id: data[0].id,\n            name: data[0].name,\n            lastName: data[0].last_name,\n            pseudo: data[0].pseudo,\n            mail: data[0].mail,\n            signUpDate: data[0].date_inscription,\n          };\n          this.setState({ user: userLoged });\n          localStorage.setItem('user', JSON.stringify(userLoged));\n        }); */\n    };\n\n    this.changeFirstName = firstName => {\n      const initialUser = JSON.parse(localStorage.getItem('user'));\n      initialUser.name = firstName;\n      localStorage.setItem('user', JSON.stringify(initialUser));\n      this.setState({\n        user: initialUser\n      });\n      /* let data = {};\n      data.id = this.state.user.id;\n      data.value = firstName;\n       fetch('http://18.191.118.60:80/changeFirstName.php', {\n        method: 'POST',\n        body: JSON.stringify(data),\n      })\n        .then((response) => {\n          return response.json();\n        })\n        .then((data) => {\n          let userLoged = {\n            id: data[0].id,\n            name: data[0].name,\n            lastName: data[0].last_name,\n            pseudo: data[0].pseudo,\n            mail: data[0].mail,\n            signUpDate: data[0].date_inscription,\n          };\n          this.setState({ user: userLoged });\n          localStorage.setItem('user', JSON.stringify(userLoged));\n        }); */\n    };\n\n    this.changeMail = mail => {\n      const initialUser = JSON.parse(localStorage.getItem('user'));\n      initialUser.mail = mail;\n\n      if (/^[a-z0-9._-]+@[a-z0-9._-]+\\.[a-z]{2,6}$/i.test(mail)) {\n        localStorage.setItem('user', JSON.stringify(initialUser));\n        this.setState({\n          user: initialUser\n        });\n        this.setState({\n          isNewMailValid: true\n        });\n      } else {\n        this.setState({\n          isNewMailValid: false\n        });\n      }\n      /* let data = {};\n      data.id = this.state.user.id;\n      data.value = mail;\n       fetch('http://18.191.118.60:80/changeMail.php', {\n        method: 'POST',\n        body: JSON.stringify(data),\n      })\n        .then((response) => {\n          return response.json();\n        })\n        .then((data) => {\n          let userLoged = {\n            id: data[0].id,\n            name: data[0].name,\n            lastName: data[0].last_name,\n            pseudo: data[0].pseudo,\n            mail: data[0].mail,\n            signUpDate: data[0].date_inscription,\n          };\n          this.setState({ user: userLoged });\n          localStorage.setItem('user', JSON.stringify(userLoged));\n        }); */\n\n    };\n\n    this.state = {\n      user: null,\n      mailAlreadyExist: false,\n      wrongLogin: false,\n      movieList: null,\n      isNewMailValid: true\n    };\n  }\n\n  componentDidMount() {\n    if (localStorage.getItem('user')) {\n      this.setState({\n        user: JSON.parse(localStorage.getItem('user'))\n      });\n    }\n\n    if (localStorage.getItem('moviesList')) {\n      this.setState({\n        movieList: JSON.parse(localStorage.getItem('moviesList'))\n      });\n    }\n  }\n\n  render() {\n    const value = { ...this.state,\n      signIn: this.signIn,\n      signUp: this.signUp,\n      changeWarningStates: this.changeWarningStates,\n      deleteUser: this.deleteUser,\n      logOut: this.logOut,\n      addMovie: this.addMovie,\n      deleteMovie: this.deleteMovie,\n      changePseudo: this.changePseudo,\n      changeLastName: this.changeLastName,\n      changeFirstName: this.changeFirstName,\n      changeMail: this.changeMail\n    };\n    return /*#__PURE__*/React.createElement(SessionContext.Provider, {\n      value: value,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 7\n      }\n    }, this.props.children);\n  }\n\n}\nexport const SessionContextConsumer = SessionContext.Consumer;","map":{"version":3,"sources":["/Users/bastpaq/Documents/student_projects/semaines-intensives/cineo-bast/cineo/src/context/session.context.jsx"],"names":["React","createContext","Component","SessionContext","SessionContextProvider","constructor","props","signIn","mail","password","e","preventDefault","infosUsers","fetch","method","body","JSON","stringify","then","response","json","data","console","log","signUp","lastName","firstName","pseudo","mailExist","setState","mailAlreadyExist","userLoged","id","user","name","last_name","signUpDate","date_inscription","localStorage","setItem","changeWarningStates","wrongLogin","deleteUser","movieList","removeItem","logOut","addMovie","filmId","moviesList","getItem","parse","newList","deleteMovie","id_movie","state","index","findIndex","el","splice","changePseudo","initialUser","changeLastName","changeFirstName","changeMail","test","isNewMailValid","componentDidMount","render","value","children","SessionContextConsumer","Consumer"],"mappings":"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","sourcesContent":["import React, { createContext, Component } from 'react';\n\nconst SessionContext = createContext({});\n\nexport class SessionContextProvider extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      user: null,\n      mailAlreadyExist: false,\n      wrongLogin: false,\n      movieList: null,\n      isNewMailValid: true,\n    };\n  }\n\n  componentDidMount() {\n    if (localStorage.getItem('user')) {\n      this.setState({ user: JSON.parse(localStorage.getItem('user')) });\n    }\n    if (localStorage.getItem('moviesList')) {\n      this.setState({\n        movieList: JSON.parse(localStorage.getItem('moviesList')),\n      });\n    }\n  }\n\n  signIn = (mail, password, e) => {\n    e.preventDefault();\n    \n    let infosUsers = {};\n    infosUsers.mail = mail;\n    infosUsers.password = password;\n\n    fetch('https://bastienpaquier.masselab.com/signIn.php', {\n      method: 'POST',\n      body: JSON.stringify(infosUsers),\n    })\n      .then(response =>  response.json())\n      .then((data) => {\n        console.log(data);\n        /* if (data.success) {\n          let userloged = {\n            id: data.user.id,\n            name: data.user.name,\n            lastName: data.user.last_name,\n            pseudo: data.user.pseudo,\n            mail: data.user.mail,\n            signUpDate: data.user.date_inscription,\n          };\n          this.setState({ user: userloged });\n          localStorage.setItem('user', JSON.stringify(userloged));\n\n          let userId = {};\n          userId.id = data.infos[0].id;\n           fetch('http://18.191.118.60:80/getMoviesList.php', {\n            method: 'POST',\n            body: JSON.stringify(userId),\n          })\n            .then((response) => {\n              return response.json();\n            })\n            .then((data) => {\n              if (data.length > 0) {\n                let movieList = [];\n                data.forEach((movie) => {\n                  movieList.push(movie.id_movie);\n                });\n                this.setState({ movieList: movieList });\n                localStorage.setItem('moviesList', JSON.stringify(movieList));\n              }\n            }); \n        } else {\n          this.setState({ wrongLogin: true });\n        } */\n      });\n  };\n\n  signUp = (lastName, firstName, mail, password, pseudo, e) => {\n    e.preventDefault();\n\n    let data = {};\n\n    data.lastName = lastName;\n    data.firstName = firstName;\n    data.mail = mail;\n    data.password = password;\n    data.pseudo = pseudo;\n\n    fetch('https://bastienpaquier.masselab.com/signUp.php', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        console.log(data);\n        if (data.mailExist) {\n          this.setState({ mailAlreadyExist: true });\n        } else {\n          let userLoged = {\n            id: data.user.id,\n            name: data.user.name,\n            lastName: data.user.last_name,\n            pseudo: data.user.pseudo,\n            mail: data.user.mail,\n            signUpDate: data.user.date_inscription,\n          };\n          this.setState({ user: userLoged });\n          localStorage.setItem('user', JSON.stringify(userLoged));\n        }\n      });\n  };\n\n  changeWarningStates = () => {\n    this.setState({ mailAlreadyExist: false, wrongLogin: false });\n  };\n\n  deleteUser = () => {\n    this.setState({ user: null, movieList: null });\n    localStorage.removeItem('user');\n    localStorage.removeItem('moviesList');\n\n    /* let data = {};\n    data.mail = this.state.user.mail;\n\n    fetch('http://18.191.118.60:80/deleteUser.php', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    })\n      .then((response) => {\n        return response.json();\n      })\n      .then((data) => {\n        this.setState({ user: null });\n        localStorage.removeItem('user');\n        localStorage.removeItem('moviesList');\n      }); */\n  };\n\n  logOut = () => {\n    this.setState({ user: null, movieList: null });\n    localStorage.removeItem('user');\n    localStorage.removeItem('moviesList');\n  };\n\n  addMovie = (filmId) => {\n    let moviesList;\n    if (localStorage.getItem('moviesList')) {\n      moviesList = [...JSON.parse(localStorage.getItem('moviesList'))];\n    } else {\n      moviesList = [];\n    }\n\n    let newList = [...moviesList, filmId];\n\n    this.setState({ movieList: newList });\n    localStorage.setItem('moviesList', JSON.stringify(newList));\n\n    /* let data = {};\n    data.idUser = this.state.user.id;\n    data.idFilm = filmId.toString();\n\n    fetch('http://18.191.118.60:80/addFilm.php', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    })\n      .then((response) => {\n        return response.json();\n      })\n      .then((data) => {\n        let movieList = [];\n        data.forEach((movie) => {\n          movieList.push(movie.id_movie);\n        });\n        this.setState({ movieList: movieList });\n        localStorage.setItem('moviesList', JSON.stringify(movieList));\n      }); */\n  };\n\n  deleteMovie = (id_movie) => {\n    const moviesList = [...this.state.movieList];\n    const index = moviesList.findIndex((el) => el === id_movie);\n    moviesList.splice(index, 1);\n\n    this.setState({ movieList: moviesList });\n    localStorage.setItem('moviesList', JSON.stringify(moviesList));\n\n    /* let data = {};\n    data.movieId = id_movie.toString();\n    data.userId = this.state.user.id;\n\n    fetch('http://18.191.118.60:80/deleteMovie.php', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    })\n      .then((response) => {\n        return response.json();\n      })\n      .then((data) => {\n        console.log(data);\n        let movieList = [];\n        data.forEach((movie) => {\n          movieList.push(movie.id_movie);\n        });\n        this.setState({ movieList: movieList });\n        localStorage.setItem('moviesList', JSON.stringify(movieList));\n      }); */\n  };\n\n  changePseudo = (pseudo) => {\n    const initialUser = JSON.parse(localStorage.getItem('user'));\n    initialUser.pseudo = pseudo;\n\n    localStorage.setItem('user', JSON.stringify(initialUser));\n    this.setState({ user: initialUser });\n    /* let data = {};\n    data.id = this.state.user.id;\n    data.value = pseudo;\n\n    fetch('http://18.191.118.60:80/changePseudo.php', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    })\n      .then((response) => {\n        return response.json();\n      })\n      .then((data) => {\n        let userLoged = {\n          id: data[0].id,\n          name: data[0].name,\n          lastName: data[0].last_name,\n          pseudo: data[0].pseudo,\n          mail: data[0].mail,\n          signUpDate: data[0].date_inscription,\n        };\n        this.setState({ user: userLoged });\n        localStorage.setItem('user', JSON.stringify(userLoged));\n      }); */\n  };\n\n  changeLastName = (lastName) => {\n    const initialUser = JSON.parse(localStorage.getItem('user'));\n    initialUser.lastName = lastName;\n\n    localStorage.setItem('user', JSON.stringify(initialUser));\n    this.setState({ user: initialUser });\n    /* let data = {};\n    data.id = this.state.user.id;\n    data.value = lastName;\n\n    fetch('http://18.191.118.60:80/changeLastName.php', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    })\n      .then((response) => {\n        return response.json();\n      })\n      .then((data) => {\n        console.log(data);\n        let userLoged = {\n          id: data[0].id,\n          name: data[0].name,\n          lastName: data[0].last_name,\n          pseudo: data[0].pseudo,\n          mail: data[0].mail,\n          signUpDate: data[0].date_inscription,\n        };\n        this.setState({ user: userLoged });\n        localStorage.setItem('user', JSON.stringify(userLoged));\n      }); */\n  };\n\n  changeFirstName = (firstName) => {\n    const initialUser = JSON.parse(localStorage.getItem('user'));\n    initialUser.name = firstName;\n\n    localStorage.setItem('user', JSON.stringify(initialUser));\n    this.setState({ user: initialUser });\n    /* let data = {};\n    data.id = this.state.user.id;\n    data.value = firstName;\n\n    fetch('http://18.191.118.60:80/changeFirstName.php', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    })\n      .then((response) => {\n        return response.json();\n      })\n      .then((data) => {\n        let userLoged = {\n          id: data[0].id,\n          name: data[0].name,\n          lastName: data[0].last_name,\n          pseudo: data[0].pseudo,\n          mail: data[0].mail,\n          signUpDate: data[0].date_inscription,\n        };\n        this.setState({ user: userLoged });\n        localStorage.setItem('user', JSON.stringify(userLoged));\n      }); */\n  };\n\n  changeMail = (mail) => {\n    const initialUser = JSON.parse(localStorage.getItem('user'));\n    initialUser.mail = mail;\n\n    if (/^[a-z0-9._-]+@[a-z0-9._-]+\\.[a-z]{2,6}$/i.test(mail)) {\n      localStorage.setItem('user', JSON.stringify(initialUser));\n      this.setState({ user: initialUser });\n\n      this.setState({ isNewMailValid: true });\n    } else {\n      this.setState({ isNewMailValid: false });\n    }\n    /* let data = {};\n    data.id = this.state.user.id;\n    data.value = mail;\n\n    fetch('http://18.191.118.60:80/changeMail.php', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    })\n      .then((response) => {\n        return response.json();\n      })\n      .then((data) => {\n        let userLoged = {\n          id: data[0].id,\n          name: data[0].name,\n          lastName: data[0].last_name,\n          pseudo: data[0].pseudo,\n          mail: data[0].mail,\n          signUpDate: data[0].date_inscription,\n        };\n        this.setState({ user: userLoged });\n        localStorage.setItem('user', JSON.stringify(userLoged));\n      }); */\n  };\n\n  render() {\n    const value = {\n      ...this.state,\n      signIn: this.signIn,\n      signUp: this.signUp,\n      changeWarningStates: this.changeWarningStates,\n      deleteUser: this.deleteUser,\n      logOut: this.logOut,\n      addMovie: this.addMovie,\n      deleteMovie: this.deleteMovie,\n      changePseudo: this.changePseudo,\n      changeLastName: this.changeLastName,\n      changeFirstName: this.changeFirstName,\n      changeMail: this.changeMail,\n    };\n\n    return (\n      <SessionContext.Provider value={value}>\n        {this.props.children}\n      </SessionContext.Provider>\n    );\n  }\n}\n\nexport const SessionContextConsumer = SessionContext.Consumer;\n"]},"metadata":{},"sourceType":"module"}